#!/bin/sh
#
# Automatically adds JIRA ticket ID based on branch name to every commit message.
#

MESSAGE=$(cat "$1")
BASEREGEX="([A-Z]{1,10}-[0-9]*)"
MSG_REGEX=$BASEREGEX

if [[ $MESSAGE =~ $MSG_REGEX ]]
then
  echo branch is already in the message
  exit
fi

BRANCH_REGEX="$BASEREGEX"
BRANCHNAME=$(git symbolic-ref -q HEAD)
[[ $BRANCHNAME =~ $BRANCH_REGEX ]]
TICKET="${BASH_REMATCH[1]}"

if [[ -n $TICKET ]]
then
  echo "$TICKET $MESSAGE" > "$1"
fi


